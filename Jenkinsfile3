pipeline {
    agent any
        environment {
            FILE="/opt/maven-9.0.73/webapps/maven-web-application.war"
    }
    tools{
    maven 'maven-3.8.6'
    }
    stages {
        stage('git') {
            steps {
               git 'https://github.com/vikashmuktha/maven-web-application-jayadeep.git'
            }
        }
        stage('Maven') {
            steps {
                sh 'mvn clean package'
            }
        }
        
        stage('File check'){
            steps{
                sshagent(['599ff7ef-ccdd-4438-bfdc-7a604ef587c1']) {
                    sh 'ssh ec2-user@172.31.49.183  "ls -la /opt/maven-9/webapps/maven-web-application.war"'
                    sh """
                       ssh ec2-user@172.31.49.183
                       source="/opt/maven-9/webapps/"
                       target="/opt/"
                       cd '\${target}'
                       foldername=$(date +%d%b%Y)
                       mkdir $foldername
                       cd '\${foldername}'
                       mkdir bkp
                       cd
                       cd '\${source}'
                       cp -R maven-web-application /opt/\$foldername/bkp
                       cp -R maven-web-application.war /opt/\$foldername/bkp
                       rm -rf maven-web-application.war"""
                    sh 'ssh ec2-user@172.31.49.183  "ls -la /opt/maven-9/webapps/maven-web-application.war"'
                    sh """ 
                    ssh ec2-user@172.31.49.183  "cd /opt/maven-9/webapps;  
                      if [ -f "$FILE" ];
                    then
                      echo "$FILE is exist"
                         "ls -la cd /opt/maven-9/webapps/maven-web-application.war"
                    else
                       echo "$FILE is not exist"
                     fi  
                       "
                      """
                }
            }
        }        
        
        /*
        stage('DeploytoContainer'){
            steps{
                sshagent(['599ff7ef-ccdd-4438-bfdc-7a604ef587c1']) {
                    sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@172.31.49.183:/opt/maven-9/webapps/"
                }    
            }
        }
        */
    }
}
